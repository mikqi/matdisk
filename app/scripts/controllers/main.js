'use strict';
angular.module('matdiskApp')
  .factory('Negara', function () {
    return [
      {
        'negara': 'Albania',
        'kodeNegara': 'AL',
        'kode': 28
      },
      {
        'negara': 'Andora',
        'kodeNegara': 'AD',
        'kode': 24
      },
      {
        'negara': 'Austria',
        'kodeNegara': 'AT',
        'kode': 20
      },
      {
        'negara': 'Azerbaijam',
        'kodeNegara': 'AZ',
        'kode': 28
      },
      {
        'negara': 'Belgium',
        'kodeNegara': 'BE',
        'kode': 16
      },
      {
        'negara': 'Bahrain',
        'kodeNegara': 'BH',
        'kode': 22
      },
      {
        'negara': 'Bosnia',
        'kodeNegara': 'BA',
        'kode': 20
      },
      {
        'negara': 'Brazil',
        'kodeNegara': 'BR',
        'kode': 29
      },
      {
        'negara': 'Bulgaria',
        'kodeNegara': 'BG',
        'kode': 22
      },
      {
        'negara': 'Costa Rica',
        'kodeNegara': 'CR',
        'kode': 21
      },
      {
        'negara': 'Croatia',
        'kodeNegara': 'HR',
        'kode': 21
      },
      {
        'negara': 'Cyprus',
        'kodeNegara': 'CY',
        'kode': 28
      },
      {
        'negara': 'Czech Republic',
        'kodeNegara': 'CZ',
        'kode': 24
      },
      {
        'negara': 'Denmark',
        'kodeNegara': 'DK',
        'kode': 18
      },
      {
        'negara': 'Dominican Republic',
        'kodeNegara': 'DO',
        'kode': 28
      },
      {
        'negara': 'Estonia',
        'kodeNegara': 'EE',
        'kode': 20
      },
      {
        'negara': 'Faroe Islands',
        'kodeNegara': 'FO',
        'kode': 18
      },
      {
        'negara': 'Finland',
        'kodeNegara': 'FI',
        'kode': 18
      },
      {
        'negara': 'France',
        'kodeNegara': 'FR',
        'kode': 27
      },
      {
        'negara': 'Georgia',
        'kodeNegara': 'GE',
        'kode': 22
      },
      {
        'negara': 'Germany',
        'kodeNegara': 'DE',
        'kode': 22
      },
      {
        'negara': 'Gibraltar',
        'kodeNegara': 'GI',
        'kode': 23
      },
      {
        'negara': 'Greece',
        'kodeNegara': 'GR',
        'kode': 27
      },
      {
        'negara': 'Greenland',
        'kodeNegara': 'GL',
        'kode': 18
      },
      {
        'negara': 'Guatemala',
        'kodeNegara': 'GT',
        'kode': 28
      },
      {
        'negara': 'Hungary',
        'kodeNegara': 'HU',
        'kode': 28
      },
      {
        'negara': 'Iceland',
        'kodeNegara': 'IS',
        'kode': 26
      },
      {
        'negara': 'Ireland',
        'kodeNegara': 'IE',
        'kode': 22
      },
      {
        'negara': 'Israel',
        'kodeNegara': 'IL',
        'kode': 23
      },
      {
        'negara': 'Italy',
        'kodeNegara': 'IT',
        'kode': 27
      },
      {
        'negara': 'Kazakhstan',
        'kodeNegara': 'KZ',
        'kode': 20
      },
      {
        'negara': 'Kuwait',
        'kodeNegara': 'KW',
        'kode': 30
      },
      {
        'negara': 'Latvia',
        'kodeNegara': 'LV',
        'kode': 21
      },
      {
        'negara': 'Lebanon',
        'kodeNegara': 'LB',
        'kode': 28
      },
      {
        'negara': 'Liechtenstein',
        'kodeNegara': 'LI',
        'kode': 21
      },
      {
        'negara': 'Lithuania',
        'kodeNegara': 'LT',
        'kode': 20
      },
      {
        'negara': 'Luxembourg',
        'kodeNegara': 'LU',
        'kode': 20
      },
      {
        'negara': 'Macedonia',
        'kodeNegara': 'MK',
        'kode': 19
      },
      {
        'negara': 'Malta',
        'kodeNegara': 'MT',
        'kode': 31
      },
      {
        'negara': 'Mauritania',
        'kodeNegara': 'MR',
        'kode': 27
      },
      {
        'negara': 'Mauritius',
        'kodeNegara': 'MU',
        'kode': 30
      },
      {
        'negara': 'Monaco',
        'kodeNegara': 'MC',
        'kode': 27
      },
      {
        'negara': 'Moldova',
        'kodeNegara': 'MD',
        'kode': 24
      },
      {
        'negara': 'Montenegro',
        'kodeNegara': 'ME',
        'kode': 22
      },
      {
        'negara': 'Netherlands',
        'kodeNegara': 'NL',
        'kode': 18
      },
      {
        'negara': 'Norway',
        'kodeNegara': 'NO',
        'kode': 15
      },
      {
        'negara': 'Pakistan',
        'kodeNegara': 'PK',
        'kode': 24
      },
      {
        'negara': 'Palestinian',
        'kodeNegara': 'PS',
        'kode': 29
      },
      {
        'negara': 'Poland',
        'kodeNegara': 'PL',
        'kode': 28
      },
      {
        'negara': 'Portugal',
        'kodeNegara': 'PT',
        'kode': 25
      },
      {
        'negara': 'Romania',
        'kodeNegara': 'RO',
        'kode': 24
      },
      {
        'negara': 'San Marino',
        'kodeNegara': 'SM',
        'kode': 27
      },
      {
        'negara': 'Saudi Arabia',
        'kodeNegara': 'SA',
        'kode': 24
      },
      {
        'negara': 'Serbia',
        'kodeNegara': 'RS',
        'kode': 22
      },
      {
        'negara': 'Slovakia',
        'kodeNegara': 'SK',
        'kode': 24
      },
      {
        'negara': 'Slovenia',
        'kodeNegara': 'SI',
        'kode': 19
      },
      {
        'negara': 'Spain',
        'kodeNegara': 'ES',
        'kode': 24
      },
      {
        'negara': 'Sweden',
        'kodeNegara': 'SE',
        'kode': 24
      },
      {
        'negara': 'Switzerland',
        'kodeNegara': 'CH',
        'kode': 21
      },
      {
        'negara': 'Tunisia',
        'kodeNegara': 'TN',
        'kode': 24
      },
      {
        'negara': 'Turkey',
        'kodeNegara': 'TR',
        'kode': 26
      },
      {
        'negara': 'United Arab emirates',
        'kodeNegara': 'AE',
        'kode': 23
      },
      {
        'negara': 'United Kingdom',
        'kodeNegara': 'GB',
        'kode': 22
      },
      {
        'negara': 'Virgin Island British',
        'kodeNegara': 'VG',
        'kode': 24
      }
    ];
  })
  .factory('Konversi', function () {
    return [
      {
        huruf: "A",
        val: 10
      },
      {
        huruf: "B",
        val: 11
      },
      {
        huruf: "C",
        val: 12
      },
      {
        huruf: "D",
        val: 13
      },
      {
        huruf: "E",
        val: 14
      },
      {
        huruf: "F",
        val: 15
      },
      {
        huruf: "G",
        val: 16
      },
      {
        huruf: "H",
        val: 17
      },
      {
        huruf: "I",
        val: 18
      },
      {
        huruf: "J",
        val: 19
      },
      {
        huruf: "K",
        val: 20
      },
      {
        huruf: "L",
        val: 21
      },
      {
        huruf: "M",
        val: 22
      },
      {
        huruf: "N",
        val: 23
      },
      {
        huruf: "O",
        val: 24
      },
      {
        huruf: "P",
        val: 25
      },
      {
        huruf: "Q",
        val: 26
      },
      {
        huruf: "R",
        val: 27
      },
      {
        huruf: "S",
        val: 28
      },
      {
        huruf: "T",
        val: 29
      },
      {
        huruf: "U",
        val: 30
      },
      {
        huruf: "V",
        val: 31
      },
      {
        huruf: "W",
        val: 32
      },
      {
        huruf: "X",
        val: 33
      },
      {
        huruf: "Y",
        val: 34
      },
      {
        huruf: "Z",
        val: 35
      }
    ]
  })
  .factory('AllData', function () {
    var funcData = {};
    var datu = [];
    var i = -1;
    funcData.getData = function () {
      return datu;
    };
    funcData.setData = function (data) {
      datu.push(data);
    };
    funcData.plusI = function(){
      i += 1;
    }
    funcData.getI = function(){
      return i;
    }
    funcData.myData = datu;

    return funcData;
  })
  .controller('MainCtrl', function ($scope, Negara, Konversi, AllData) {
    $scope.pageClass = 'page-home';
    $scope.Negara = Negara;
    $scope.Konversi = Konversi;
    $scope.send = AllData;

    $scope.addCountry = function () {
      var newCountry = JSON.parse($scope.myCountry);
      $scope.data = {
        negara: newCountry.negara,
        kodeNegara: newCountry.kodeNegara,
        kode: newCountry.kode
      };

      var myKodeNegara = $scope.data.kodeNegara;
      var kodeNegara1 = myKodeNegara.substr(0, 1);
      var kodeNegara2 = myKodeNegara.substr(1, 1);

      /**
       * Iterasi buat konkversi
       */
      for (var i in Konversi) {
        if (angular.equals(Konversi[i].huruf, kodeNegara1)) {
          $scope.kode1 = Konversi[i].val;
        }
        if (angular.equals(Konversi[i].huruf, kodeNegara2)) {
          $scope.kode2 = Konversi[i].val;
        }
      }
      //      $scope.validate = function(){
      //        $scope.iban = $scope.kodeBban + $scope.kode1.toString() + $scope.kode2.toString() + $scope.kodeLokal;
      //        $scope.iban2 = $scope.data.kodeNegara + $scope.kodeLokal + $scope.kodeBban;
      //
      //        $scope.result = parseInt($scope.iban) % 97;
      ////      $scope.anu = IBAN.fromBBAN($scope.data.kodeNegara.toString(), $scope.bban.toString())
      //        if($scope.result === 1){
      //          $scope.hasilValidasi = IBAN.isValid($scope.iban2);
      //        }else{
      //          $scope.hasilValidasi = IBAN.isValid($scope.iban2);
      //        }
      //      }

      $scope.validate = function () {
        $scope.iban = $scope.kodeBban + $scope.kode1.toString() + $scope.kode2.toString() + $scope.kodeLokal;
        $scope.iban2 = $scope.data.kodeNegara + $scope.kodeLokal + $scope.kodeBban;

        $scope.result = parseInt($scope.iban) % 97;
        //      $scope.anu = IBAN.fromBBAN($scope.data.kodeNegara.toString(), $scope.bban.toString())
        //        if ($scope.result === 1) {
        //          $scope.hasilValidasi = IBAN.isValid($scope.iban2);
        //        } else {
        //          $scope.hasilValidasi = IBAN.isValid($scope.iban2);
        //        }
        $scope.hasilValidasi = IBAN.isValid($scope.iban2);
        $scope.allData = [
          {
            data: $scope.data
          },
          {
            kode1: $scope.kode1
          },
          {
            kode2: $scope.kode2
          },
          {
            iban: $scope.iban2
          },
          {
            hasil: $scope.hasilValidasi
          }
        ];

        $scope.sendData = function () {
          $scope.send.setData($scope.allData);
          $scope.send.plusI();
          console.log("SENDED");
          console.log($scope.send.getData());
        };
        //        AllData.set($scope.allData);

        //          $scope.getHasil($scope.allData);
      };
    };

  })
  .controller('ResultCtrl', function ($scope, AllData) {
    $scope.pageClass = 'page-result';
    $scope.validasiData = AllData;
    $scope.i = $scope.validasiData.getI();

    $scope.negara = $scope.validasiData.myData[$scope.i][0].data.negara;
    $scope.kodeNegara = $scope.validasiData.myData[$scope.i][0].data.kodeNegara;
    $scope.kode = $scope.validasiData.myData[$scope.i][0].data.kode;

    $scope.kode1 = $scope.validasiData.myData[$scope.i][1].kode1;
    $scope.kode2 = $scope.validasiData.myData[$scope.i][2].kode2;
    $scope.iban = $scope.validasiData.myData[$scope.i][3].iban;
    $scope.hasil = $scope.validasiData.myData[$scope.i][4].hasil;

    if ($scope.hasil) {
      $scope.textHasil = "VALID";
    } else {
      $scope.textHasil = "INVALID";
    }

    $scope.getBack = function () {
      window.history.back();
    }
  })
//  .controller('ResultCtrl', function($scope, Negara, Konversi){
//    $scope.pageClass = 'page-result';
//
//    $scope.Negara = Negara;
//    $scope.Konversi = Konversi;
//
//    $scope.getHasil = function (data){
//      alert(data);
//    }
//  })
;